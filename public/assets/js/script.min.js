var loading=false;$(function(){var f=window.location.hash.split("#!/")[1]||"",e=1,a=$(window),g=$("#pl"),c=typeof history.pushState=="function";if(c){var d=("state" in window.history),b=location.href;$(window).bind("popstate",function(i){var h=!d&&location.href==b;d=true;if(h){return}f=window.location.hash.split("#!/")[1]||"";$("#s").val(f);e=1;$("#pl").html("");get_games(f,e)})}if(!loading){$("#s").val(f);get_games(f,e)}$("form").submit(function(h){input=$("#s");f=input.val();input.blur();e=1;$("#pl").html("");get_games(f,e);if(c){history.pushState({},f,"#!/"+f)}h.preventDefault()});a.scroll(function(){if((a.scrollTop()+a.height())>(g.height()+g.offset().top-200)&&!loading){e++;get_games(f,e);loading=true}});$(".tv").live("click",function(h){$(this).closest(".p").toggleClass("active").siblings().removeClass("active");h.preventDefault()})});function get_games(b,a){$("h3").remove();$("#pl").after('<h3 id="loading">&#x203B;</h3>');loading=true;$.ajax({url:"http://tradaculator.com/values/"+b+"/"+a,dataType:"jsonp",cache:true,timeout:10000,error:function(c){$("#loading").remove();$("#pl").after("<h3>Something exploded.</h3>")},success:function(d){$("#loading").remove();var c="";$.each(d,function(f,e){var h=[];$.each(e.tradeInValue,function(j,i){if(i.value){i.vendor=j;h.push(i)}});h.sort(function(j,i){return parseInt(i.value.replace(/[\$\.]/g,""),10)-parseInt(j.value.replace(/[\$\.]/g,""),10)});if(e.tradeInValue){var g=e.name.split(" - ");c+='<article class="p">';c+='<div class="pw">';c+="<figure>";c+='<img src="'+e.image+'" alt="" />';c+="</figure>";c+="<header>";c+="<h1>"+g[0]+"</h1>";c+="<p>"+g[g.length-1]+"</p>";c+="</header>";c+='<div class="pbw"><div class="b"><a class="vn" target="_blank" href="'+h[0].url+'">Trade It In</a><a href="#" class="tv">'+h[0].value+"</a></div>";c+='<ul class="dd">';$.each(h,function(j,i){c+='<li><a target="_blank" href="'+i.url+'">'+i.vendor.replace("_"," ")+" <span>"+i.value+"</span></a></li>"});c+="</ul>";c+="</div></div>";c+="</article>"}});if(c!==""){$("#pl").append(c);loading=false}else{$("#pl").after("<h3>That's all there is.</h3>")}}})};