var loading=false;$(function(){var f=1,b=$(window),e=get_hash()||"",g=$("#pl"),c=typeof history.pushState=="function";if(c){var d=("state" in window.history),a=location.href;b.bind("popstate",function(h){var i=!d&&location.href==a;d=true;if(i){return}e=get_hash(b)||"";$("#pl").html("");before_get_games(e,f=1)})}if(!loading){before_get_games(e,f)}$("form").submit(function(h){input=$("#s");e=input.val();input.blur();f=1;$("#pl").html("");get_games(e,f);if(c){history.pushState({},e,"#!/"+e)}h.preventDefault()});b.scroll(function(){if((b.scrollTop()+b.height())>(g.height()+g.offset().top-200)&&!loading){f++;get_games(e,f);loading=true}});$(".tv").live("click",function(h){$(this).closest(".p").toggleClass("active").siblings().removeClass("active");h.preventDefault()})});function get_hash(){var a=window.location.hash.split("#!/")[1];if(a){return a.replace(/%20/g," ")}}function before_get_games(b,a){$("#s").val(b);get_games(b,a)}function get_games(b,a){$("h3").remove();$("#pl").after('<h3 id="l">&#x203B;</h3>');loading=true;$.ajax({url:"http://tradaculator.com/values/"+b+"/"+a,dataType:"jsonp",cache:true,timeout:10000,error:function(c){$("#l").remove();$("#pl").after("<h3>Something exploded</h3>")},success:function(d){$("#l").remove();var c="";$.each(d,function(f,e){var h=[];$.each(e.tradeInValue,function(j,i){if(i.value){i.vendor=j;h.push(i)}});h.sort(function(j,i){return parseInt(i.value.replace(/[\$\.]/g,""),10)-parseInt(j.value.replace(/[\$\.]/g,""),10)});if(e.tradeInValue){var g=e.name.split(" - ");c+='<div class="p">';c+='<div class="pw">';c+='<div class="f">';c+='<img src="'+e.image+'" alt="" />';c+="</div>";c+="<header>";c+="<h1>"+g[0]+"</h1>";c+="<p>"+g[g.length-1]+"</p>";c+="</header>";c+='<div class="pbw"><div class="b"><a class="vn" target="_blank" href="'+h[0].url+'">Trade It In</a><a href="#" class="tv">'+h[0].value+"</a></div>";c+='<ul class="dd">';$.each(h,function(j,i){c+='<li><a target="_blank" href="'+i.url+'">'+i.vendor.replace("_"," ")+" <span>"+i.value+"</span></a></li>"});c+="</ul>";c+="</div></div>";c+="</div>"}});if(c!==""){$("#pl").append(c);loading=false}else{$("#pl").after("<h3>That's all</h3>")}}})};