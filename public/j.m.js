var loading=false;$(function(){var h=1,l=$(window),i="",b=$("#pl"),d=typeof history.pushState=="function";if(d){var c=("state" in window.history),m=location.href;l.bind("popstate",function(o){var p=!c&&location.href==m;c=true;if(p){return}i=n(l)||"";$("#pl").html("");j(i,h=1)})}if(!loading){j(i,h)}$("form").submit(function(o){input=$("#s");i=input.val();input.blur();h=1;$("#pl").html("");k(i,h);if(d){history.pushState({},i,"#!/"+i)}o.preventDefault()});l.scroll(function(){if((l.scrollTop()+l.height())>(b.height()+b.offset().top-200)&&!loading){h++;k(i,h);loading=true}});$(".tv").live("click",function(o){$(this).closest(".p").toggleClass("active").siblings().removeClass("active");o.preventDefault()});function n(){var o=window.location.hash.split("#!/")[1];if(o){return o.replace(/%20/g," ")}}function j(p,o){$("#s").val(p);k(p,o)}function k(p,o){$("h3").remove();$("#pl").after('<h3 id="l">&#x203B;</h3>');loading=true;g(p,o)}function f(o){e("http://api.glyde.com/price/upc/"+o+"?api_key=tradaculat_u8mBCp87&v=1&responseType=application/json",function(q){if(q.suggested_price.cents>0){var p=q.suggested_price.cents*0.88/100-1.25;$("body").trigger({type:"custom_loaded_"+o,value:"$"+p.toFixed(2),vendor:"Glyde",url:"http://glyde.com/sell?hash=%21by%2Fproduct%2Flineup%2Fgames%2F"+q.glu_id+"#!show/product/"+q.glu_id+""})}else{$("body").trigger({type:"custom_loaded_"+o})}})}function g(p,o){if(p){p="&Title="+p}e("http://xmltojsonp.appspot.com/onca/json?Operation=ItemSearch"+p+"&ItemPage="+o+"&BrowseNode=979418011&SearchIndex=VideoGames&ResponseGroup=ItemAttributes,Images",function(q){if(q=q.ItemSearchResponse.Items.Item){var r="";$.each(q,function(s,u){var w=u.MediumImage.URL;var v=u.ASIN;u=u.ItemAttributes;if(u.TradeInValue){var x=[];r+=u.UPC+",";x.push({value:u.TradeInValue.FormattedPrice,vendor:"Amazon",url:"https://www.amazon.com/gp/tradein/add-to-cart.html/ref=trade_new_dp_trade_btn?ie=UTF8&asin="+v});f(u.UPC);var t=0;$("body").bind("custom_loaded_"+u.UPC,function(y){if(y.value){x.push(y)}t++;if(t>=1){x.sort(function(A,z){return parseInt(z.value.replace(/[\$\.]/g,""),10)-parseInt(A.value.replace(/[\$\.]/g,""),10)});$("#l").remove();a(u.Title,u.Platform,w,x);$("body").unbind("custom_loaded_"+u.UPC)}})}})}else{$("#l").remove();$("#pl").after("<h3>That's all</h3>");loading=true}})}function e(p,o,q){p="http://jsonpify.heroku.com/?resource="+p;$.ajax({url:p,dataType:"jsonp",cache:true,success:function(r){o(r)}})}function a(p,o,r,s){var q="";q+='<div class="p">';q+='<div class="pw">';q+='<div class="f">';q+='<img src="'+r+'" alt="" />';q+="</div>";q+="<header>";q+="<h1>"+p+"</h1>";q+="<p>"+o+"</p>";q+="</header>";q+='<div class="pbw"><div class="b"><a class="vn" target="_blank" href="'+s[0].url+'">Trade It In</a><a href="#" class="tv">'+s[0].value+"</a></div>";q+='<ul class="dd">';$.each(s,function(u,t){q+='<li><a target="_blank" href="'+t.url+'">'+t.vendor+" <span>"+t.value+"</span></a></li>"});q+="</ul>";q+="</div></div>";q+="</div>";$("#pl").append(q);loading=false}});